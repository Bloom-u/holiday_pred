发明名称
一种基于预测纠偏的云控系统时延补偿方法
摘要
本发明公开了一种基于预测纠偏的云控系统通信时延补偿方法。首先构建车辆端与交通控制中心（TCC）之间的通信时延模型，解析上行传输、计算处理与下行传输等环节的时延特性，将总时延分解为固定部分与随机部分；针对固定时延，采用卡尔曼滤波进行车辆状态预测，修正控制指令实际执行时刻的纵向位置、速度与加速度，消除状态滞后；针对随机时延，建立两阶段加速度轨迹纠偏模型，通过附加加速度同时补偿位置与速度偏差。该方法可在存在固定与随机通信时延的条件下显著降低轨迹跟踪误差与追尾风险，提升匝道合流等复杂场景下的运行安全与通行效率。
本申请属于交通流量预测技术领域，具体涉及一种基于混合专家架构的节假日感知交通流量预测方法及系统，其中的方法包括：构建多维度特征工程模块，提取包括滞后特征、滚动统计特征、节假日类型特征及节假日上下文特征在内的高级特征；基于混合专家架构构建预测模型，所述模型包括改进的特征编码器、节假日感知注意力模块和自适应预测头；采用极端过采样策略和自适应损失函数对模型进行训练，使节假日样本获得更高的采样权重和损失权重；结合标准预测与滚动预测策略进行集成预测。本申请能够有效提高交通流量预测在节假日期间的准确性，解决了传统预测方法在节假日场景下预测精度显著下降的技术问题。
 
权利要求书
1. 一种基于预测纠偏的云控系统时延补偿方法，其特征在于，包括如下步骤：
S1：建立车辆端系统与交通控制中心（TCC）之间的通信时延模型，识别上行传输时延、计算处理时延与下行传输时延的组成及统计特性，将总时延分解为固定部分与随机部分；
S2：针对固定时延，基于卡尔曼滤波进行状态预测，得到控制指令实际执行时刻的车辆纵向位置、速度与加速度，用以替代滞后测量作为轨迹规划的初始状态；
S3：针对随机时延，构建两阶段加速度轨迹纠偏模型，在纠偏总时长内先施加正向附加加速度、后施加反向附加加速度，使位置与速度偏差同时收敛。
2. 根据权利要求1所述的方法，其特征在于，所述步骤S1中，通信时延模型的建立包括：
（1）上行传输时延 T_u：指车辆端向TCC上传状态信息所经历的时间，包括传输时延（与数据包大小及链路带宽有关）、处理时延（网络设备协议解析、加密校验等）、排队时延（网络拥塞情况下的数据等待时间）以及传播时延（信号在链路上的传播时间）；
（2）计算处理时延 T_c：TCC执行轨迹规划算法所需的计算时间；
（3）下行传输时延 T_d：TCC向车辆端下发控制指令所经历的传输、处理、排队和传播时延；
其中，上行与下行时延分别独立服从高斯分布 N(μ_u,σ_u^2) 和 N(μ_d,σ_d^2)，计算处理时延为常数 T_c，总时延 T_total 的均值与标准差分别为：
█(μ_total  =μ_u  +μ_d  + T_c#(1) )
█(σ_total  =√(σ_u^2+σ_d^2 )#(2) )
由高斯分布的可加性可知：
█(T_total= N(μ_total,σ_total^2 )#(3) )
该建模方法能够在复杂通信环境下准确反映时延的确定性和随机性特征，为后续分段补偿策略奠定数学基础。
3. 建立车辆运动学离散状态空间模型，假设车辆在采样周期内作匀加速直线运动，状态向量包括纵向位置x、速度v和加速度a，状态更新方程为：
位置更新方程：
█(x_(k+1)=x_k+v_k Δt+1/2 a_k Δt^2+w_x#(4) )
速度更新方程：
█(v_(k+1)=v_k+a_k Δt+w_v#(5) )
加速度更新方程：
█(├ a_(k+1)={█(&a_cmd+w_a,@&a_k+w_a,)┤┤#(6) )
其中，a_cmd为控制输入加速度，w_x,w_v,w_a为零均值高斯白噪声；
（2）预测阶段：利用状态转移矩阵 F 和控制输入矩阵 B，基于上一时刻的最优状态估计与控制输入预测当前位置、速度和加速度：
█(X ̂k|k-1=FXk-1|k-1+Bu_(k-1)#(7) )
并预测协方差矩阵：
█(P_(k|k-1)=FP_(k-1|k-1) F^T+Q#(8) )
其中，Q 为过程噪声协方差矩阵
（3）更新阶段：测量值向量 Z_k（含位置、速度等信息）与观测矩阵 H（将状态映射至观测空间的矩阵）用于修正预测状态：
█(K_k=P_(k|k-1) H^T (HP_(k|k-1) H^T+R)^(-1)#(9) )
█(X_(k|k)=X ̂k|k-1+K_k (Z_k-HX ̂k|k-1)#(10) )
█(P_(k|k)=(I-K_k H)P_(k|k-1)#(11) )
其中，R 为观测噪声协方差矩阵，I 为单位矩阵。
4. 根据权利要求1所述的方法，其特征在于，所述步骤S3包括：
（1）将纠偏总时间T_cor等分为两个阶段，每个阶段的时长为T；：
①阶段1（0<t≤T）
对车辆施加恒定的正向纠偏加速度j_1。即除了原有加速度a_0外，再额外叠加一个值为+j_1的加速度，使得车辆整体处于匀加速运动状态。其动力学方程为：
█({█(a(t)&=a_0+j_1，加速度方程@v(t)&=v_0+a_0 t+j_1 t，速度方程@x(t)&=x_0+v_0 t+1/2 a_0 t^2+1/2 j_1 t^2，位置方程)┤#(12) )
阶段1结束时（t=T），车辆的加速度、速度与位置可分别表示为：
█({█(a_1&=a_0+j_1@v_1&=v_0+a_0 T+j_1 T@x_1&=x_0+v_0 T+1/2 a_0 T^2+1/2 j_1 T^2 )┤#(13) )
②阶段2（T<t≤2T）
向车辆施加恒定的负向纠偏加速度-j_2，用以抵消并修正前一个阶段所带来的额外加速，从而在两段时间内实现对位置偏差的补偿与控制。
加速度方程为
█(a(t)=a_0-j_2#(14) )
速度方程，车辆的速度可通过对加速度在[T,t]区间上进行积分，并叠加第一阶段结束时的速度v_1求得，为
█(v(t)=∫_T^t▒(a_0-j_2 )dt+v_1=v_0+j_1 T+j_2 T+a_0 t-j_2 t#(15) )
位置方程，将速度v(t)在[T,t]区间积分，同时考虑到第一阶段末位置x_1作为第二阶段初始位置，为
x(t)=∫_T^t▒(v_0+j_1 T+j_2 T+a_0 t-j_2 t)dt+x_1
█(=x_0-(j_1 T^2)/2-(j_2 T^2)/2+v_0 t+j_1 Tt+j_2 Tt+1/2 a_0 t^2-1/2 j_2 t^2#(16) )
阶段2结束时t=2T，各动力学变量为
█({█(a_2&=a_0-jT，加速度方程@v_2&=v_0+2a_0 T+j_1 T-j_2 T，速度方程@x_2&=x_0+2v_0 T+2a_0 T^2+(3j_1 T^2)/2-(j_2 T^2)/2，位置方程)┤#(17) )
（2）位移补偿量与速度补偿量
为评估纠偏过程的效果，我们将纠偏结束时刻t=2T时车辆的实际位置x_2与无纠偏过程的假定位置x_norm进行比较。无纠偏过程车辆在两个阶段均保持原加速度a_0匀加速运动，其在t=2T时位置可表达为
█(x_norm=x_0+2v_0 T+2a_0 T^2#(18) )
而经过纠偏过程后，车辆在两个阶段分别施加附加加速度j_1和-j_2，使得实际位置变为
█(x_2=x_0+2v_0 T+2a_0 T^2+(3j_1 T^2)/2-(j_2 T^2)/2#(19) )
式中，(3j_1 T^2)/2-(j_2 T^2)/2为纠偏加速度对位移所产生的额外贡献。如图所示，原有加速度对应的位移2v_0 T+2a_0 T^2在纠偏与无纠偏情况下相同，考虑到T_cor=2T，施加纠偏加速度引起的位移变化为
█(Δx_comp=(x_2-x_0 )-x_norm=(3j_1 T^2)/2-(j_2 T^2)/2=((3j_1-j_2 ) T_cor^2)/8#(20) )
同样地，为了量化纠偏阶段中车辆在速度上的补偿增益，可以定义速度补偿量为
Δv_comp=(v_2-v_0 )-v_norm
其中，v_norm为无纠偏情况下的预期速度。经过推导可得
█(Δv_comp=(j_1-j_2 )T=((j_1-j_2 ) T_cor)/2#(21) )
若车辆要在纠偏时间T_cor内完成位移偏差和速度偏差的修正，则位移补偿量Δx_comp和速度补偿量Δv_comp需满足
█({█(Δx_comp=Δx@Δv_comp=Δv)┤⇒{█(((3j_1-j_2 ) T_cor^2)/8=Δx@((j_1-j_2 ) T_cor)/2=Δv)┤#(22) )
联立以上方程，满足纠偏要求的附加纠偏加速度方程如下
█({█(j_1=(2Δx-TΔv)/(2T^2 )@j_2=(2Δx-3TΔv)/(2T^2 ))┤#(23) )
由此，在已知需要补偿的位移量Δx和速度量Δv的情况下，可直接利用公式（23）确定车辆在纠偏过程中的附加纠偏加速度参数。


 
说明书
一种基于编队协同的高速公路匝道合流控制方法
技术领域 
本发明属于智能网联车辆交通控制技术领域，具体涉及一种基于预测纠偏的云控系统通信时延补偿方法，适用于匝道合流、瓶颈路段、编队行驶等对时效性和安全性要求较高的协同控制场景。
背景技术 
在智能网联车辆的协同控制系统中，车辆与交通控制中心（Traffic Control Center，简称 TCC）之间通过车联网通信实现信息交互与轨迹控制。然而，由于网络传输和计算处理等环节不可避免地存在延迟，通信时延会导致车辆的实际状态与轨迹规划输入数据之间存在滞后，从而影响控制指令的准确性与执行效果。现有研究多集中于车辆轨迹规划与合流顺序优化，但普遍假设通信过程无延迟或延迟固定，忽略了通信时延的随机性与波动性。尤其在高速匝道合流等对时效性要求极高的场景下，即便是数百毫秒的延迟也可能导致车辆无法准确执行预定轨迹，增加追尾与冲突风险。因此，亟需一种能够同时处理固定时延与随机时延的补偿方法，以提升系统的鲁棒性和安全性。
发明内容
发明目的：本发明旨在针对智能网联车辆云控系统中存在的通信时延问题，提出一种基于预测-纠偏的时延补偿方法，将总时延分解为固定部分与随机波动部分，分别采用状态预测和轨迹纠偏策略进行补偿，从而减少轨迹跟踪误差，提高车辆运行安全性和交通流稳定性。
技术方案：为实现上述目的，本发明提出以下时延补偿方法：
1. 一种基于预测纠偏的云控系统时延补偿方法，其特征在于，包括如下步骤：
S1：建立车辆端系统与交通控制中心（TCC）之间的通信时延模型，识别上行传输时延、计算处理时延与下行传输时延的组成及统计特性，将总时延分解为固定部分与随机部分；
S2：针对固定时延，基于卡尔曼滤波进行状态预测，得到控制指令实际执行时刻的车辆纵向位置、速度与加速度，用以替代滞后测量作为轨迹规划的初始状态；
S3：针对随机时延，构建两阶段加速度轨迹纠偏模型，在纠偏总时长内先施加正向附加加速度、后施加反向附加加速度，使位置与速度偏差同时收敛。
2. 根据权利要求1所述的方法，其特征在于，所述步骤S1中，通信时延模型的建立包括：
（1）上行传输时延 T_u：指车辆端向TCC上传状态信息所经历的时间，包括传输时延（与数据包大小及链路带宽有关）、处理时延（网络设备协议解析、加密校验等）、排队时延（网络拥塞情况下的数据等待时间）以及传播时延（信号在链路上的传播时间）；
（2）计算处理时延 T_c：TCC执行轨迹规划算法所需的计算时间；
（3）下行传输时延 T_d：TCC向车辆端下发控制指令所经历的传输、处理、排队和传播时延；
其中，上行与下行时延分别独立服从高斯分布 N(μ_u,σ_u^2) 和 N(μ_d,σ_d^2)，计算处理时延为常数 T_c，总时延 T_total 的均值与标准差分别为：
█(μ_total  =μ_u  +μ_d  + T_c#(1) )
█(σ_total  =√(σ_u^2+σ_d^2 )#(2) )
由高斯分布的可加性可知：
█(T_total= N(μ_total,σ_total^2 )#(3) )
该建模方法能够在复杂通信环境下准确反映时延的确定性和随机性特征，为后续分段补偿策略奠定数学基础。
3. 根据权利要求1所述的方法，其特征在于，所述步骤S2中，固定时延的补偿过程包括：建立车辆运动学离散状态空间模型，假设车辆在采样周期内作匀加速直线运动，状态向量包括纵向位置x、速度v和加速度a，状态更新方程为：
位置更新方程：
█(x_(k+1)=x_k+v_k Δt+1/2 a_k Δt^2+w_x#(4) )
速度更新方程：
█(v_(k+1)=v_k+a_k Δt+w_v#(5) )
加速度更新方程：
█(├ a_(k+1)={█(&a_cmd+w_a,@&a_k+w_a,)┤┤#(6) )
其中，a_cmd为控制输入加速度，w_x,w_v,w_a为零均值高斯白噪声；
（2）预测阶段：利用状态转移矩阵 F 和控制输入矩阵 B，基于上一时刻的最优状态估计与控制输入预测当前位置、速度和加速度：
█(X ̂k|k-1=FXk-1|k-1+Bu_(k-1)#(7) )
并预测协方差矩阵：
█(P_(k|k-1)=FP_(k-1|k-1) F^T+Q#(8) )
其中，Q 为过程噪声协方差矩阵
（3）更新阶段：测量值向量 Z_k（含位置、速度等信息）与观测矩阵 H（将状态映射至观测空间的矩阵）用于修正预测状态：
█(K_k=P_(k|k-1) H^T (HP_(k|k-1) H^T+R)^(-1)#(9) )
█(X_(k|k)=X ̂k|k-1+K_k (Z_k-HX ̂k|k-1)#(10) )
█(P_(k|k)=(I-K_k H)P_(k|k-1)#(11) )
其中，R 为观测噪声协方差矩阵，I 为单位矩阵。
4. 根据权利要求1所述的方法，其特征在于，所述步骤S3包括：
（1）将纠偏总时间T_cor等分为两个阶段，每个阶段的时长为T，如图1所示。
①阶段1（0<t≤T）
对车辆施加恒定的正向纠偏加速度j_1。即除了原有加速度a_0外，再额外叠加一个值为+j_1的加速度，使得车辆整体处于匀加速运动状态。其动力学方程为：
█({█(a(t)&=a_0+j_1，加速度方程@v(t)&=v_0+a_0 t+j_1 t，速度方程@x(t)&=x_0+v_0 t+1/2 a_0 t^2+1/2 j_1 t^2，位置方程)┤#(12) )
阶段1结束时（t=T），车辆的加速度、速度与位置可分别表示为：
█({█(a_1&=a_0+j_1@v_1&=v_0+a_0 T+j_1 T@x_1&=x_0+v_0 T+1/2 a_0 T^2+1/2 j_1 T^2 )┤#(13) )
②阶段2（T<t≤2T）
向车辆施加恒定的负向纠偏加速度-j_2，用以抵消并修正前一个阶段所带来的额外加速，从而在两段时间内实现对位置偏差的补偿与控制。
加速度方程为
█(a(t)=a_0-j_2#(14) )
速度方程，车辆的速度可通过对加速度在[T,t]区间上进行积分，并叠加第一阶段结束时的速度v_1求得，为
█(v(t)=∫_T^t▒(a_0-j_2 )dt+v_1=v_0+j_1 T+j_2 T+a_0 t-j_2 t#(15) )
位置方程，将速度v(t)在[T,t]区间积分，同时考虑到第一阶段末位置x_1作为第二阶段初始位置，为
x(t)=∫_T^t▒(v_0+j_1 T+j_2 T+a_0 t-j_2 t)dt+x_1
█(=x_0-(j_1 T^2)/2-(j_2 T^2)/2+v_0 t+j_1 Tt+j_2 Tt+1/2 a_0 t^2-1/2 j_2 t^2#(16) )
阶段2结束时t=2T，各动力学变量为
█({█(a_2&=a_0-jT，加速度方程@v_2&=v_0+2a_0 T+j_1 T-j_2 T，速度方程@x_2&=x_0+2v_0 T+2a_0 T^2+(3j_1 T^2)/2-(j_2 T^2)/2，位置方程)┤#(17) )
（2）位移补偿量与速度补偿量
为评估纠偏过程的效果，我们将纠偏结束时刻t=2T时车辆的实际位置x_2与无纠偏过程的假定位置x_norm进行比较。无纠偏过程车辆在两个阶段均保持原加速度a_0匀加速运动，其在t=2T时位置可表达为
█(x_norm=x_0+2v_0 T+2a_0 T^2#(18) )
而经过纠偏过程后，车辆在两个阶段分别施加附加加速度j_1和-j_2，使得实际位置变为
█(x_2=x_0+2v_0 T+2a_0 T^2+(3j_1 T^2)/2-(j_2 T^2)/2#(19) )
式中，(3j_1 T^2)/2-(j_2 T^2)/2为纠偏加速度对位移所产生的额外贡献。如图所示，原有加速度对应的位移2v_0 T+2a_0 T^2在纠偏与无纠偏情况下相同，考虑到T_cor=2T，施加纠偏加速度引起的位移变化为
█(Δx_comp=(x_2-x_0 )-x_norm=(3j_1 T^2)/2-(j_2 T^2)/2=((3j_1-j_2 ) T_cor^2)/8#(20) )
同样地，为了量化纠偏阶段中车辆在速度上的补偿增益，可以定义速度补偿量为
Δv_comp=(v_2-v_0 )-v_norm
其中，v_norm为无纠偏情况下的预期速度。经过推导可得
█(Δv_comp=(j_1-j_2 )T=((j_1-j_2 ) T_cor)/2#(21) )
若车辆要在纠偏时间T_cor内完成位移偏差和速度偏差的修正，则位移补偿量Δx_comp和速度补偿量Δv_comp需满足
█({█(Δx_comp=Δx@Δv_comp=Δv)┤⇒{█(((3j_1-j_2 ) T_cor^2)/8=Δx@((j_1-j_2 ) T_cor)/2=Δv)┤#(22) )
联立以上方程，满足纠偏要求的附加纠偏加速度方程如下
█({█(j_1=(2Δx-TΔv)/(2T^2 )@j_2=(2Δx-3TΔv)/(2T^2 ))┤#(23) )
由此，在已知需要补偿的位移量Δx和速度量Δv的情况下，可直接利用公式（23）确定车辆在纠偏过程中的附加纠偏加速度参数。
 
图1纠偏过程示意图

附图说明
图1为本发明方法的整体纠偏过程示意图；
图2为本发明实施例的高速公路单车道匝道合流场景示意图；
图3为本发明实施例中车辆2的加速度—时间曲线图；
图4为本发明实施例中车辆2的速度—时间曲线图，其中(a)为纠偏开始局部放大图，(b)为完整曲线图，(c)为纠偏结束局部放大图；
图5为本发明实施例中车辆2的位置—时间曲线图，其中(a)为纠偏开始局部放大图，(b)为完整曲线图，(c)为纠偏结束局部放大图；
表1为本发明实施例中各车辆时延补偿结果汇总表。

具体实施方式
以下结合一具体实施例对本发明的基于预测纠偏的云控系统时延补偿方法进行说明。本实施例以高速公路单车道匝道合流场景为例，完整展示时延补偿模型的工作流程。
应用本发明的基于预测纠偏的云控系统时延补偿方法的一个具体实施例如图*所示。主线与匝道车辆分别有两辆车在合流区域进行协同控制。车辆1和车辆3到合流点的距离为260m，车辆2和车辆4到合流点的距离为300m，所有的初始速度为12m/s。云端交通控制中心（TCC）实时采集和处理车辆的状态信息，计算合流过程中的最优轨迹，并下发控制指令。
 
图2 实施例场景示意图
在步骤S1中，建立车辆端系统与交通控制中心（TCC）之间的通信时延模型。在本实施例中，通信时延模型的参数设定如下：上行传输时延T_u服从正态分布N(0.03，〖0.15〗^2)秒，计算处理时延T_c为常数1.94秒，下行传输时延T_d服从正态分布N(0.03，〖0.15〗^2)秒。根据公式(1)-(3)，得到总时延的统计特性：均值μ_total  = 0.03 + 1.94 + 0.03 = 2.0秒，标准差σ_total=√(〖0.15〗^2+〖0.15〗^2 )=0.212秒，因此总时延T_total  ~ N(2.0,0.212²)。
在步骤S2中，针对固定时延进行状态预测。以车辆2为例，在t=0.5s时刻测得车辆状态为：位置x=24.0m、速度v=12.0m/s、加速度a=0.8m/s²，并建立状态向量X=[x, v, a]^T。利用卡尔曼滤波器根据公式(7)-(11)预测车辆在指令预期执行时刻（t=2.5s）的状态：预测位置x̂=48.0m、预测速度v̂=13.6m/s、预测加速度â=0.8m/s²，为云端轨迹规划提供较为准确的初始状态。
然而，如图4和图5所示，预测状态与实际状态之间存在一定偏差。这种偏差源于两个方面：一是状态预测误差，体现在预测状态偏离实际车辆状态；二是由通信时延的随机性导致指令实际执行时刻（t=2.56s）滞后于预期执行时刻（2.5s）0.06s，导致车辆状态产生误差。两种误差的叠加形成了车辆在开始执行云端指令时的累积状态偏差。
 
图3加速度-时间曲线图（车辆2）
 
（a）纠偏开始局部放大    （b）完整曲线      （c）纠偏结束局部放大
图4速度-时间曲线图（车辆2）

 
（a）纠偏开始局部放大    （b）完整曲线      （c）纠偏结束局部放大
图5位置-时间曲线图（车辆2）
在步骤S3中，车辆在收到云端的指令时，进行两阶段轨迹纠偏。如图3所示，由于通信随机时延，车辆2实际在t=2.56s才接收到控制指令，较预期滞后0.06s。此时车辆实际状态与预测状态存在偏差：位置偏差Δx=-0.364m，速度偏差Δv=-0.099m/s。纠偏时间T_cor=1.94s，根据公式(23)，计算两阶段纠偏加速度：j_2=-0.336m/s²，j_2=-0.232m/s²。
第一阶段（t=2.56s至3.53s，持续0.97s）车辆施加附加纠偏加速度j₁=-0.336m/s²；第二阶段（t=3.53s至4.50s，持续0.97s）车辆施加附加纠偏加速度-j₂=0.232m/s²。从图4（c）和图5（c）以观察到，通过实施分段纠偏控制，车辆的速度和位置逐渐向规划轨迹收敛。当t=4.5s时，纠偏过程完成，车辆进入规划轨迹执行阶段，其运动特性均与云端规划轨迹保持高度一致，实现了对通信时延引起状态偏差的有效补偿。
采用相同的方法对其他三辆车辆进行时延补偿处理。如表1所示，车辆1、车辆3、车辆4分别面临不同程度的初始状态偏差，通过各自对应的两阶段纠偏加速度控制，均在约2秒的纠偏时间内成功将状态误差收敛到规划轨迹，验证了本发明方法对于不同初始条件的良好适应性。
表1车辆时延补偿结果汇总表
编号	位置偏差(m)	速度偏差(m/s)	纠偏时间(s)	j_1(m/s^2)	j_2(m/s^2)
1	-0.623	-0.217	2.05	-0.487	-0.275
2	-0.364	-0.099	1.94	-0.336	-0.232
3	0.319	0.079	2.08	0.257	0.181
4	-0.167	-0.057	2.01	-0.138	-0.081

实施本发明的时延补偿方法后，所有车辆均能在纠偏完成后精确跟踪云端规划轨迹，有效提高了智能网联车辆协同控制系统在存在通信时延条件下的轨迹跟踪精度和运行安全性。
以上所述仅是本发明的优选实施方式，应当指出：对于本技术领域的普通技术人员来说，在不脱离本发明原理的前提下，还可以做出若干改进和润饰，这些改进和润饰也应视为本发明的保护范围。
